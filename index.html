<!DOCTYPE html>
<html>
    <head>
        <title>Red Cross Hackathon</title>
        <meta charset = "utf-8">
        <meta name = "description" content = "Red Cross">
        <meta name = "viewport" content = "width = device-width, initial-scale = 1">
        <link rel = "stylesheet" href = "src/style.css">
        
        <script type = 'text/javascript' src = "https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.min.js"></script>
        
        <script type = 'text/javascript'>
            const key = 'ff9ba92f56ed4ed0b1edf0bc8a23b311'
            var location
            var address
            var destAddress
            var rcLocations

            function getLoc() {
                function f(pos) {location = pos}
                navigator.geolocation.getCurrentPosition(f)
            }

            function getAddress() {
                fetch(`https://api.geoapify.com/v1/geocode/reverse?lat=${location.latitude}&lon=${location.longitude}&apiKey=${key}`)
                .then(response => response.json())
                .then(result => {
                    if (result.features.length) {
                        add = result.features[0].properties.formatted;
                    } else {
                        console.log("No address found");
                    }
                })
            }

            function getLocations() {
                fetch("http://app.redcross.org/nss-app/pages/mapServicesList.jsp?action=list")
                .then(response => response.json())
                .then(result => {
                    if (result.features.length) {
                        rcLocations = result.features[0].properties.formatted;
                    } else {
                        console.log("No address found");
                    }
                })
            }

            function get() {
                getLoc()
                getAddress()
                window.open(`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(add)}&destination=${encodeURIComponent(add)}`)
            }
        </script>
    </head>

    <body>
        <input type = "button" onClick = "get()" value = "Search" /><br/>
        <div id = "output"></div>
    </body>
</html>